import { Canvas, Meta, Story } from '@storybook/addon-docs'
import { useState, useEffect, useRef, createRef } from 'react'

import { subscribe } from './subscribe.ts'

<Meta title="MDX/Helpers/Subscribe" />

# When Online

<!-- add a plugin description -->

<Canvas>
  <Story name="Subscribe usage">
    {() => {
      const btnRef = useRef(null)
      const init = 0
      const [state, setState] = useState(init)
      useEffect(() => {
        const unsubscribe = subscribe(btnRef.current, 'click', callBack)
        btnRef.current.click()
        unsubscribe()
        btnRef.current.click()
      }, [])
      const callBack = () => setState(state => state + 1)
      return (
        <>
          <button ref={btnRef} style={{ display: 'none' }}>
            button
          </button>
          <div>
            <span className="font-bold">Description</span>
            <div className="p-2 pb-4">
              <p>
                higher-order function: subscribes target to events, returns a
                function describing target from an event.
              </p>
            </div>
          </div>
          <div>
            <span className="font-bold">Arguments</span>
            <div className="p-2 pb-4">
              <p className="ui-text-ink-secondary">
                target (Window | Document | HTMLElement | EventTarget)
              </p>
              <p className="ui-text-ink-secondary">eventType (String)</p>
              <p className="ui-text-ink-secondary">callBack (Function)</p>
              <p className="ui-text-ink-secondary">...args ( [options] )</p>
            </div>
          </div>
          <div>
            <span className="font-bold">Returns</span>
            <p className="p-2 pb-4">
              <span className="ui-text-ink-secondary">function: void</span>
            </p>
          </div>
          <span className="font-bold">Example</span>
          <div className="yobta-bg-paper-2 w-max p-4">
            <pre>
              <code>{`let target = document.querySelector<HTMLButtonElement>('button')
let clickCount = 0`}</code>
              <p className="ui-text-color-14 p-4">// clickCount = {init}</p>
              <code>{`let eventType = 'click'
let callBack = (): void => {
  clickCount += 1
}
let unsubscribe = subscribe(target, eventType, callBack)
target?.click()`}</code>
              <p className="ui-text-color-14 p-4">// clickCount = {state}</p>
              <code>{`unsubscribe()
target?.click()`}</code>
              <p className="ui-text-color-14 p-4">// clickCount = {state}</p>
            </pre>
          </div>
        </>
      )
    }}
  </Story>
</Canvas>
